<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Bots Deriv - Playground HTML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    /* Reset e Base */
    *, *::before, *::after {
      box-sizing: border-box;
    }

    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Inter', Arial, sans-serif;
      background: #121519;
      color: #e0e6eb;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }

    /* Scrollbar Personalizada */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }
    ::-webkit-scrollbar-track {
      background: #181c20;
    }
    ::-webkit-scrollbar-thumb {
      background: #373b3e;
      border-radius: 4px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #4a4f53;
    }

    /* Navbar */
    .navbar {
      width: 100%;
      background: #1f2327;
      color: #64ffda;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 30px;
      height: 60px;
      flex-shrink: 0;
      box-shadow: 0 2px 10px rgba(0,0,0,0.3);
      z-index: 100;
    }

    .navbar-logo {
      font-weight: bold;
      font-size: 1.4em;
      letter-spacing: 1px;
      display: flex;
      align-items: center;
    }
    .navbar-logo i {
        margin-right: 10px;
        font-size: 1.2em;
    }

    .navbar-menu {
      list-style: none;
      display: flex;
      gap: 28px;
      margin: 0;
      padding: 0;
    }

    .navbar-menu li {
      display: inline-block;
    }

    .navbar-menu li a {
      color: #b0bec5;
      text-decoration: none;
      font-weight: 500;
      transition: color 0.2s ease-in-out;
      padding: 8px 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .navbar-menu li a:hover,
    .navbar-menu li a.active-link {
      color: #64ffda;
    }
    .navbar-menu li a.active-planilha-link {
        color: #82e9de;
    }
    .navbar-menu li a.active-planilha-link i {
        color: #82e9de;
    }


    .container {
      display: flex;
      flex-grow: 1;
      overflow: hidden;
    }

    .sidebar {
      width: 260px;
      background: #1f2327;
      padding: 20px 0;
      box-shadow: 2px 0 10px rgba(0,0,0,0.2);
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
      overflow-y: auto;
    }

    .sidebar h2 {
      color: #64ffda;
      text-align: center;
      margin-bottom: 25px;
      font-size: 1.25em;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .bot-list {
      flex: 1;
      overflow-y: auto;
    }
    .bot-list p {
      text-align: center;
      color: #78909c;
      padding: 20px 15px;
      font-size: 0.9em;
    }


    .bot-item {
      padding: 12px 18px;
      cursor: pointer;
      border: none;
      background: none;
      color: #b0bec5;
      text-align: left;
      width: 100%;
      font-size: 0.95em;
      font-weight: 500;
      transition: background 0.2s ease-in-out, color 0.2s ease-in-out;
      border-radius: 6px;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
    }
    .bot-item i {
        margin-right: 10px;
        color: #78909c;
        transition: color 0.2s ease-in-out;
        width: 18px;
        text-align: center;
    }

    .bot-item:hover, .bot-item.active {
      background: #2c313a;
      color: #64ffda;
    }
    .bot-item:hover i, .bot-item.active i {
        color: #64ffda;
    }
    #bot-list > .bot-item {
        margin-left: 15px;
        margin-right: 15px;
        width: calc(100% - 30px);
    }


    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      padding: 25px 30px;
      overflow-y: auto;
      background-color: #181c20;
    }

    .editor-label {
      margin-bottom: 10px;
      color: #90a4ae;
      font-size: 0.9em;
      font-weight: 500;
    }

    #bot-name {
      width: 100%;
      padding: 12px 15px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #373b3e;
      background: #23272b;
      color: #e0e6eb;
      font-size: 1em;
      font-family: 'Inter', sans-serif;
      transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    }
    #bot-name:focus {
        outline: none;
        border-color: #64ffda;
        box-shadow: 0 0 0 3px rgba(100, 255, 218, 0.3);
    }
    #bot-name[readonly] {
      background-color: #2a2e32 !important;
      color: #a0a0a0 !important;
      cursor: not-allowed;
    }

    #bot-editor {
      width: 100%;
      flex-grow: 1;
      min-height: 250px;
      background: #101214;
      color: #e0e6eb;
      border: 1px solid #373b3e;
      border-radius: 6px;
      padding: 15px;
      font-family: 'Fira Code', 'Consolas', monospace;
      font-size: 0.95em;
      line-height: 1.6;
      resize: vertical;
      box-sizing: border-box;
      transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out, background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    }
    #bot-editor:focus {
        outline: none;
        border-color: #64ffda;
        box-shadow: 0 0 0 3px rgba(100, 255, 218, 0.3);
    }
    #bot-editor[readonly] {
        background-color: #16191d !important;
        color: #a0a0a0 !important;
        cursor: not-allowed;
    }


    .actions {
      margin-top: 20px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      flex-shrink: 0;
    }

    .actions button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #64ffda;
      color: #181c20;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      cursor: pointer;
      font-size: 0.95em;
      transition: background 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out, opacity 0.2s ease-in-out;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .actions button i {
        font-size: 0.9em;
    }
    .actions button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
    }
    .actions button:disabled:hover {
        background-color: #64ffda;
    }


    .actions button:not(:disabled):hover {
      background: #43c6ac;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(100, 255, 218, 0.2);
    }
    .actions button:not(:disabled):active {
        transform: translateY(-1px);
        box-shadow: 0 2px 5px rgba(100, 255, 218, 0.15);
    }

    #delete-bot-btn {
      background: #ff5252;
      color: #fff;
    }
    #delete-bot-btn:not(:disabled):hover {
      background: #d32f2f;
      box-shadow: 0 4px 10px rgba(255, 82, 82, 0.2);
    }
    #delete-bot-btn:not(:disabled):active {
        box-shadow: 0 2px 5px rgba(255, 82, 82, 0.15);
    }
    #delete-bot-btn:disabled:hover {
        background-color: #ff5252;
    }


    #fullscreen-iframe {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      width: 100vw;
      height: 100vh;
      border: none;
      z-index: 9999;
      display: none;
      background: #181c20;
    }

    #back-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      z-index: 10000;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      background: #64ffda;
      color: #181c20;
      font-weight: 600;
      cursor: pointer;
      font-size: 0.95em;
      font-family: 'Inter', sans-serif;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      transition: background 0.2s ease-in-out, transform 0.1s ease-in-out;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    #back-btn:hover {
      background: #43c6ac;
      transform: translateY(-2px);
    }

    #novo-bot-btn-wrapper {
        padding: 0 15px;
    }

    #novo-bot-btn {
      width: 100%;
      background: transparent;
      color: #64ffda;
      border: 1px solid #64ffda;
      font-weight: 600;
      font-family: 'Inter', sans-serif;
      border-radius: 6px;
      padding: 10px 16px;
      cursor: pointer;
      transition: background 0.2s ease-in-out, color 0.2s ease-in-out;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }

    #novo-bot-btn:hover {
      background: #64ffda;
      color: #181c20;
    }

    /* Planilha Styles */
    .planilha-full-bg {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(18, 21, 25, 0.97);
      z-index: 99999;
      display: none;
      flex-direction: column;
      align-items: center;
      padding: 20px 0;
      overflow-y: auto;
    }

    .planilha-full-bg.active {
      display: flex;
    }

    .planilha-header {
      width: 100%;
      background: #1f2327;
      color: #64ffda;
      padding: 20px 0;
      text-align: center;
      font-size: 1.8em;
      font-weight: 600;
      letter-spacing: 1.5px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      flex-shrink: 0;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      position: relative;
    }
    #save-feedback {
      font-size: 0.7em;
      margin-left: 15px;
      color: #64ffda;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
    }


    .planilha-form {
      display: flex;
      flex-wrap: wrap;
      gap: 15px 20px;
      background: #23272b;
      border-radius: 10px;
      padding: 20px;
      margin: 0 20px 20px 20px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.25);
      max-width: 1200px;
      width: calc(100% - 40px);
      justify-content: center;
      flex-shrink: 0;
    }

    .planilha-form label, .planilha-form .currency-selector-label {
      display: flex;
      flex-direction: column;
      color: #b0bec5;
      font-size: 0.88em;
      font-weight: 500;
      min-width: 165px;
      flex: 1 1 165px;
      margin-bottom: 0;
    }
    .planilha-form label span, .planilha-form .currency-selector-label span {
        margin-bottom: 6px;
        color: #64ffda;
        display: flex;
        align-items: center;
        gap: 6px;
    }
    .planilha-form label span i, .planilha-form .currency-selector-label span i {
        font-size: 0.9em;
    }

    .planilha-form input[type="number"],
    .planilha-form input[type="text"],
    .planilha-form select {
      margin-top: 0;
      padding: 9px 11px;
      border-radius: 6px;
      border: 1px solid #373b3e;
      background: #181c20;
      color: #e0e6eb;
      font-size: 0.95em;
      font-family: 'Inter', sans-serif;
      transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .planilha-form input:focus, .planilha-form select:focus {
        outline: none;
        border-color: #64ffda;
        box-shadow: 0 0 0 3px rgba(100, 255, 218, 0.3);
    }
    .planilha-form select {
        cursor: pointer;
    }


    .planilha-form input[readonly] {
      background: #2a2e32 !important;
      cursor: default !important;
      opacity: 0.8;
    }
    #jc-dias-meta {
        color: #ffeb3b !important;
        font-weight: bold;
    }

    .planilha-form input#jc-stopwin {
      color: #64ffda !important;
      font-weight: bold;
    }

    .planilha-form input#jc-stoploss {
      color: #ff5252 !important;
      font-weight: bold;
    }

    .planilha-btns {
      width: 100%;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 12px;
      margin-top: 15px;
      flex-shrink: 0;
    }
     .planilha-btns button {
        padding: 10px 20px;
        border: none;
        border-radius: 6px;
        font-weight: 600;
        font-family: 'Inter', sans-serif;
        cursor: pointer;
        font-size: 0.95em;
        transition: background 0.2s ease-in-out, transform 0.1s ease-in-out, box-shadow 0.2s ease-in-out;
        display: flex;
        align-items: center;
        gap: 8px;
    }
    .planilha-btns button.calculate-btn {
        background: #64ffda;
        color: #181c20;
        margin-right: auto;
    }
    .planilha-btns button.calculate-btn:hover {
        background: #43c6ac;
        transform: translateY(-2px);
        box-shadow: 0 4px 10px rgba(100, 255, 218, 0.2);
    }

    .planilha-close {
      background: #ff5252;
      color: #fff;
    }
    .planilha-close:hover {
      background: #d32f2f;
      transform: translateY(-2px);
      box-shadow: 0 4px 10px rgba(255, 82, 82, 0.2);
    }


    .planilha-table-wrap {
      width: calc(100% - 40px);
      max-width: 1200px;
      margin: 0 auto 24px auto;
      overflow-x: auto;
      background: #1f2327;
      border-radius: 10px;
      box-shadow: 0 6px 25px rgba(0,0,0,0.25);
      padding: 0;
      flex-grow: 1;
      display: flex;
      flex-direction: column;
    }

    table.planilha-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.9em;
      margin: 0;
      min-width: 950px; /* Ajustado para 6 colunas */
    }

    .planilha-table th,
    .planilha-table td {
      padding: 12px 15px;
      text-align: right;
      border-bottom: 1px solid #2c313a;
      white-space: nowrap;
    }

    .planilha-table th:first-child,
    .planilha-table td:first-child { /* Dia */
      text-align: center;
      padding-left: 20px;
    }
     .planilha-table td:nth-child(4) { /* Informar Banca Final (input) */
        text-align: center;
     }
     .planilha-table td:nth-child(6) { /* Ação (botões) */
        text-align: center;
     }
    .planilha-table th:last-child,
    .planilha-table td:last-child { /* Ação (botões) */
      padding-right: 20px;
    }


    .planilha-table th {
      background: #23272b;
      color: #64ffda;
      font-weight: 600;
      position: sticky;
      top: 0;
      z-index: 1;
      border-bottom-width: 2px;
      border-bottom-color: #373b3e;
    }
    .planilha-table th i {
        margin-right: 6px;
    }

    .planilha-table tr:nth-child(even) td {
      background: #23272b;
    }
    .planilha-table tr:nth-child(odd) td {
      background: #1f2327;
    }
    .planilha-table tr:hover td {
        background-color: #2c313a;
    }

    .planilha-table tr.meta-hit td {
      background: #1b5e20 !important;
      color: white !important;
    }

    .planilha-table tr.loss-hit td {
      background: #b71c1c !important;
      color: white !important;
    }

    .meta-btn,
    .stop-btn,
    .clear-btn {
      padding: 6px 10px;
      font-size: 0.85rem;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 0 3px;
      transition: background 0.2s ease-in-out, transform 0.1s ease-in-out, opacity 0.2s ease-in-out;
      font-weight: 500;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .meta-btn i, .stop-btn i, .clear-btn i {
        font-size: 0.9em;
    }

    .meta-btn {
      background: #48bb78;
      color: white;
    }
    .meta-btn:not(:disabled):hover {
      background: #38a169;
      transform: scale(1.05);
    }

    .stop-btn {
      background: #f56565;
      color: white;
    }
    .stop-btn:not(:disabled):hover {
      background: #e53e3e;
      transform: scale(1.05);
    }

    .clear-btn {
      background: #6c757d;
      color: white;
    }
    .clear-btn:hover {
      background: #5a6268;
      transform: scale(1.05);
    }
    .meta-btn:disabled, .stop-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
    }
    .meta-btn:disabled:hover {
        background-color: #48bb78;
    }
    .stop-btn:disabled:hover {
        background-color: #f56565;
    }

    .meta-btn.active-action { background: #2f855a !important; }
    .stop-btn.active-action { background: #c53030 !important; }


    .banca-final-dia-input {
      width: 100%;
      max-width: 120px;
      padding: 8px;
      border-radius: 5px;
      border: 1px solid #373b3e;
      background: #121519;
      color: #e0e6eb;
      font-size: 0.9em;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
      text-align: right;
      transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
    }
    .banca-final-dia-input:focus {
        outline: none;
        border-color: #64ffda;
        background-color: #181c20;
    }

    input:focus, textarea:focus, button:focus, select:focus {
      outline: 2px solid rgba(100, 255, 218, 0.5);
      outline-offset: 1px;
    }
    *:focus:not(:focus-visible) {
        outline: none;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-logo"><i class="fas fa-brain"></i>Bots Deriv</div>
    <ul class="navbar-menu">
      <li><a href="#" class="active-link" title="Página Inicial"><i class="fas fa-home"></i> Home</a></li>
      <li><a href="#" title="Documentação"><i class="fas fa-book"></i> Docs</a></li>
      <li><a href="#" title="Sobre o Projeto"><i class="fas fa-info-circle"></i> Sobre</a></li>
      <li><a href="#" onclick="abrirPlanilha()" title="Abrir Planilha de Juros Compostos Diários"><i class="fas fa-calculator"></i> Planilha Diária</a></li>
    </ul>
  </nav>

  <!-- Container Principal -->
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <h2><i class="fas fa-list-ul"></i> Bots Salvos</h2>
      <div class="bot-list" id="bot-list">
        <!-- Gerado pelo JS -->
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <input type="text" id="bot-name" placeholder="Nome do Bot">
      <label class="editor-label" for="bot-editor">Código HTML:</label>
      <textarea id="bot-editor" placeholder="Insira seu código HTML aqui..."></textarea>
      <div class="actions">
        <button onclick="salvarBot()"><i class="fas fa-save"></i> Salvar Bot</button>
        <button onclick="executarBot()"><i class="fas fa-play"></i> Executar</button>
        <button onclick="atualizarBot()"><i class="fas fa-sync-alt"></i> Atualizar</button>
        <button id="delete-bot-btn" onclick="deletarBot()"><i class="fas fa-trash-alt"></i> Excluir Bot</button>
      </div>
    </main>
  </div>

  <!-- Iframe que cobre a tela -->
  <iframe id="fullscreen-iframe"></iframe>
  <button id="back-btn" onclick="fecharFullscreen()" style="display: none;"><i class="fas fa-arrow-left"></i> Voltar</button>

  <!-- Planilha de Juros Compostos Diários -->
  <div class="planilha-full-bg" id="planilha-full">
    <div class="planilha-header">
        <i class="fas fa-chart-line"></i> Planilha de Juros Compostos Diários
        <span id="save-feedback"></span>
    </div>

    <div class="planilha-form">
      <label title="Valor inicial do seu investimento">
        <span><i class="fas fa-dollar-sign"></i> Capital Inicial:</span>
        <input type="number" id="jc-capital" placeholder="Ex: 1000" step="any">
      </label>
      <label title="Percentual de rendimento esperado por dia">
        <span><i class="fas fa-percentage"></i> Taxa Diária (%):</span>
        <input type="number" id="jc-taxa" placeholder="Ex: 1" step="any">
      </label>
      <label title="Número de dias para o cálculo">
        <span><i class="far fa-calendar-alt"></i> Dias (Período):</span>
        <input type="number" id="jc-dias-periodo" placeholder="Ex: 30" step="1" min="0">
      </label>
      <div class="currency-selector-label" title="Escolha a moeda para a planilha">
          <span><i class="fas fa-coins"></i> Moeda:</span>
          <select id="jc-currency">
              <option value="BRL">BRL (R$)</option>
              <option value="USD">USD ($)</option>
          </select>
      </div>
      <label title="Valor total acumulado ao final do período (projeção ideal)">
        <span><i class="fas fa-coins"></i> Montante Final Proj.:</span>
        <input type="text" id="jc-montante" readonly>
      </label>
      <label title="Total de juros ganhos durante o período (projeção ideal)">
        <span><i class="fas fa-hand-holding-usd"></i> Juros Totais Proj.:</span>
        <input type="text" id="jc-juros" readonly>
      </label>
      <label title="Meta de ganho: Montante Final Projetado + 10%">
        <span><i class="fas fa-arrow-trend-up"></i> Stop Win (M. Final Proj. + 10%):</span>
        <input type="text" id="jc-stopwin" readonly>
      </label>
      <label title="Limite de perda: Capital Inicial - 10%">
        <span><i class="fas fa-arrow-trend-down"></i> Stop Loss (C. Inicial - 10%):</span>
        <input type="text" id="jc-stoploss" readonly>
      </label>
      <label title="Dias restantes para atingir o Stop Win projetado do período">
        <span><i class="fas fa-hourglass-half"></i> Dias para Meta Período:</span>
        <input type="text" id="jc-dias-meta" readonly>
      </label>

      <div class="planilha-btns">
        <button class="calculate-btn" onclick="calcularJurosCompostosDiarios()"><i class="fas fa-calculator"></i> Calcular / Recalcular</button>
        <button class="planilha-close" onclick="fecharPlanilha()"><i class="fas fa-times"></i> Fechar</button>
      </div>
    </div>

    <div class="planilha-table-wrap">
      <table class="planilha-table" id="juros-table">
        <thead>
          <tr>
            <th><i class="far fa-calendar-check"></i> Dia</th>
            <th><i class="fas fa-wallet"></i> Capital Início Dia</th>
            <th><i class="fas fa-bullseye"></i> Meta Lucro Dia</th>
            <th id="th-informar-banca-final"><i class="fas fa-edit"></i> Informar Banca Final (<span id="th-banca-final-dia-currency-symbol">R$</span>)</th>
            <th><i class="fas fa-piggy-bank"></i> Banca Final Dia (Real)</th>
            <th><i class="fas fa-tasks"></i> Ação</th>
          </tr>
        </thead>
        <tbody>
          <!-- Linhas geradas dinamicamente -->
        </tbody>
      </table>
    </div>
  </div>

  <script>
    // --- (Lógica dos Bots - INALTERADA) ---
    const botNameInput = document.getElementById('bot-name');
    const botEditor = document.getElementById('bot-editor');
    const fullscreenIframe = document.getElementById('fullscreen-iframe');
    const backBtn = document.getElementById('back-btn');
    const botList = document.getElementById('bot-list');
    const saveNewBotButton = document.querySelector('.actions button:nth-child(1)');
    const editUpdateButton = document.querySelector('.actions button:nth-child(3)');

    function bloquearEditor() {
        botNameInput.readOnly = true;
        botEditor.readOnly = true;
        if(editUpdateButton) {
            editUpdateButton.innerHTML = '<i class="fas fa-edit"></i> Editar Bot';
            editUpdateButton.onclick = habilitarEdicaoBot;
        }
        if(saveNewBotButton) saveNewBotButton.disabled = true;
    }
    function habilitarEdicaoCampos() {
        botNameInput.readOnly = false;
        botEditor.readOnly = false;
        if(saveNewBotButton) saveNewBotButton.disabled = false;
    }
    function habilitarEdicaoBot() {
        habilitarEdicaoCampos();
        botEditor.focus();
        if(editUpdateButton) {
            editUpdateButton.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar';
            editUpdateButton.onclick = atualizarBot;
        }
    }
    function salvarBot() {
      const nome = botNameInput.value.trim();
      const codigo = botEditor.value.trim();
      if (!nome || !codigo) {
        alert('Por favor, insira um nome e um código para o bot.');
        return;
      }
      const botExistente = localStorage.getItem(`bot_${nome}`);
      if (botExistente) {
          if (!confirm(`Um bot com o nome "${nome}" já existe. Deseja sobrescrevê-lo?`)) {
            return;
          }
      }
      localStorage.setItem(`bot_${nome}`, codigo);
      alert(`Bot "${nome}" salvo com sucesso!`);
      atualizarListaBots();
      selecionarBotNaLista(nome);
      bloquearEditor();
    }
    function executarBot() {
      const codigo = botEditor.value.trim();
      if (!codigo) {
        alert('Por favor, insira um código válido.');
        return;
      }
      fullscreenIframe.srcdoc = codigo;
      fullscreenIframe.style.display = 'block';
      backBtn.style.display = 'flex';
    }
    function fecharFullscreen() {
      fullscreenIframe.style.display = 'none';
      backBtn.style.display = 'none';
      fullscreenIframe.srcdoc = '';
    }
    function deletarBot() {
      const nome = botNameInput.value.trim();
      if (!nome || botNameInput.readOnly === false) {
        alert('Carregue um bot para excluí-lo.');
        return;
      }
      if (confirm(`Tem certeza que deseja excluir o bot "${nome}"?`)) {
        localStorage.removeItem(`bot_${nome}`);
        alert(`Bot "${nome}" excluído.`);
        novoBot();
      }
    }
    function atualizarBot() {
      let nomeOriginalDoBotAtivo = null;
      const botAtivoNaLista = document.querySelector('.bot-item.active');
      if (botAtivoNaLista) {
          const textoCompleto = botAtivoNaLista.textContent.trim();
          nomeOriginalDoBotAtivo = textoCompleto.substring(textoCompleto.indexOf(' ') + 1).trim();
      }
      if (!nomeOriginalDoBotAtivo) {
          alert("Nenhum bot selecionado para atualizar.");
          novoBot();
          return;
      }
      const nomeNovoNoInput = botNameInput.value.trim();
      const codigoNovo = botEditor.value.trim();
      if (!nomeNovoNoInput || !codigoNovo) {
          alert("Nome do bot e código não podem estar vazios.");
          return;
      }
      if (nomeOriginalDoBotAtivo !== nomeNovoNoInput) {
          if (localStorage.getItem(`bot_${nomeNovoNoInput}`)) {
              if (!confirm(`Você renomeou para "${nomeNovoNoInput}", que já existe. Sobrescrever?`)) {
                  botNameInput.value = nomeOriginalDoBotAtivo;
                  return;
              }
          }
          localStorage.removeItem(`bot_${nomeOriginalDoBotAtivo}`);
      }
      localStorage.setItem(`bot_${nomeNovoNoInput}`, codigoNovo);
      alert(`Bot "${nomeNovoNoInput}" atualizado!`);
      atualizarListaBots();
      selecionarBotNaLista(nomeNovoNoInput);
      bloquearEditor();
    }
    function carregarBot(nome) {
      const codigo = localStorage.getItem(`bot_${nome}`);
      if (codigo !== null) {
        botNameInput.value = nome;
        botEditor.value = codigo;
        bloquearEditor();
        if(editUpdateButton) editUpdateButton.disabled = false;
      } else {
        alert(`Bot "${nome}" não encontrado.`);
        novoBot();
      }
    }
    function selecionarBotNaLista(nomeDoBot) {
        document.querySelectorAll('.bot-item').forEach(item => {
            item.classList.remove('active');
            const nomeNoBotao = item.textContent.trim().substring(item.textContent.trim().indexOf(' ') + 1);
            if (nomeNoBotao === nomeDoBot) {
                 item.classList.add('active');
            }
        });
    }
    function novoBot() {
      botNameInput.value = '';
      botEditor.value = '';
      habilitarEdicaoCampos();
      botNameInput.focus();
      document.querySelectorAll('.bot-item.active').forEach(activeBtn => activeBtn.classList.remove('active'));
      if(editUpdateButton) {
            editUpdateButton.innerHTML = '<i class="fas fa-sync-alt"></i> Atualizar';
            editUpdateButton.onclick = atualizarBot;
            editUpdateButton.disabled = true;
      }
      if(saveNewBotButton) saveNewBotButton.disabled = false;
    }
    function atualizarListaBots() {
      botList.innerHTML = '';
      const keys = Object.keys(localStorage);
      const botKeys = keys.filter(key => key.startsWith('bot_')).sort();
      let hasBots = false;

      const novoBtnWrapper = document.createElement('div');
      novoBtnWrapper.id = 'novo-bot-btn-wrapper';
      const novoBtnEl = document.createElement('button');
      novoBtnEl.id = 'novo-bot-btn';
      novoBtnEl.innerHTML = `<i class="fas fa-plus-circle"></i> Novo Bot`;
      novoBtnEl.onclick = novoBot;
      novoBtnWrapper.appendChild(novoBtnEl);
      botList.appendChild(novoBtnWrapper);

      if (botKeys.length > 0) {
        hasBots = true;
        botKeys.forEach(key => {
          const nome = key.replace('bot_', '');
          const btn = document.createElement('button');
          btn.className = 'bot-item';
          btn.innerHTML = `<i class="fas fa-robot"></i> ${nome}`;
          btn.onclick = () => {
            document.querySelectorAll('.bot-item.active').forEach(activeBtn => activeBtn.classList.remove('active'));
            btn.classList.add('active');
            carregarBot(nome);
          };
          if (nome === botNameInput.value && botNameInput.readOnly) {
              btn.classList.add('active');
          }
          botList.appendChild(btn);
        });
      }
      if (!hasBots) {
        const p = document.createElement('p');
        p.innerHTML = `<i class="fas fa-ghost" style="margin-right: 5px;"></i> Nenhum bot salvo ainda.`;
        botList.appendChild(p);
        if(editUpdateButton) editUpdateButton.disabled = true;
      } else {
         const botAtivo = document.querySelector('.bot-item.active');
         if(editUpdateButton) editUpdateButton.disabled = !botAtivo;
      }
    }

    // --- Lógica da Planilha de Juros Compostos Diários (Simplificada V2) ---
    const planilhaFull = document.getElementById('planilha-full');
    const jcCapitalInput = document.getElementById("jc-capital");
    const jcTaxaInput = document.getElementById("jc-taxa");
    const jcDiasPeriodoInput = document.getElementById("jc-dias-periodo");
    const jcCurrencySelect = document.getElementById('jc-currency');
    const jcMontanteOutput = document.getElementById('jc-montante');
    const jcJurosOutput = document.getElementById('jc-juros');
    const jcStopWinOutput = document.getElementById('jc-stopwin');
    const jcStopLossOutput = document.getElementById('jc-stoploss');
    const jcDiasMetaOutput = document.getElementById('jc-dias-meta');
    const jurosTableBody = document.querySelector("#juros-table tbody");
    const saveFeedbackEl = document.getElementById('save-feedback');
    const thBancaFinalDiaCurrencySymbol = document.getElementById('th-banca-final-dia-currency-symbol');

    const PLANILHA_STORAGE_KEY_DIARIA_V6 = 'planilhaJurosCompostosDiariosData_v6'; // Mantendo a chave, pois a estrutura de salvar é a mesma
    let saveFeedbackTimeoutDiaria;
    let currentCurrencyDiaria = 'BRL';

    function formatCurrencyDiaria(value, currencyCode = currentCurrencyDiaria, includeSymbol = true) {
        const options = { style: includeSymbol ? 'currency' : 'decimal', currency: currencyCode, minimumFractionDigits: 2, maximumFractionDigits: 2 };
        const locale = currencyCode === 'BRL' ? 'pt-BR' : 'en-US';
         try {
            if (typeof value !== 'number' || isNaN(value)) {
                value = 0;
            }
            let formatted = value.toLocaleString(locale, options);
            return formatted;
        } catch (e) {
            const symbol = includeSymbol && currencyCode === 'BRL' ? 'R$' : (includeSymbol ? '$' : '');
            let numStr = typeof value === 'number' ? value.toFixed(2) : '0.00';
            if (currencyCode === 'BRL') numStr = numStr.replace('.', ',');
            return `${symbol} ${numStr}`;
        }
    }

    function updateCurrencyDisplayDiaria() {
        if(thBancaFinalDiaCurrencySymbol) {
            thBancaFinalDiaCurrencySymbol.textContent = currentCurrencyDiaria === 'BRL' ? 'R$' : '$';
        }
        const bancaFinalInputs = jurosTableBody.querySelectorAll('.banca-final-dia-input');
        bancaFinalInputs.forEach(input => {
            const capitalDaLinhaParaPlaceholder = parseFloat(input.dataset.capitalInicioDia) || 0;
            input.placeholder = formatCurrencyDiaria(capitalDaLinhaParaPlaceholder, currentCurrencyDiaria, false);
        });
    }

    function exibirFeedbackSalvoDiaria() {
        if (saveFeedbackEl) {
            saveFeedbackEl.innerHTML = '<i class="fas fa-check-circle"></i> Salvo!';
            saveFeedbackEl.style.opacity = '1';
            clearTimeout(saveFeedbackTimeoutDiaria);
            saveFeedbackTimeoutDiaria = setTimeout(() => { saveFeedbackEl.style.opacity = '0'; }, 1500);
        }
    }

    function salvarPlanilhaDiaria() {
        const data = {
            capital: parseFloat(jcCapitalInput.value.replace(',', '.')) || 0,
            taxaDiaria: parseFloat(jcTaxaInput.value.replace(',', '.')) || 0,
            diasPeriodo: parseInt(jcDiasPeriodoInput.value) || 0,
            currency: currentCurrencyDiaria,
            linhas: []
        };

        const linhasTabela = jurosTableBody.querySelectorAll("tr");
        linhasTabela.forEach(tr => {
            const dia = parseInt(tr.dataset.dia);
            const inputBancaFinalEl = tr.querySelector('.banca-final-dia-input');
            const bancaFinalDia = parseFloat(inputBancaFinalEl.value.replace(',', '.')) || 0;
            let acao = null;
            if (tr.classList.contains('meta-hit')) acao = 'meta';
            else if (tr.classList.contains('loss-hit')) acao = 'stop';
            data.linhas.push({ dia, bancaFinalInformada: bancaFinalDia, acao });
        });

        localStorage.setItem(PLANILHA_STORAGE_KEY_DIARIA_V6, JSON.stringify(data));
        exibirFeedbackSalvoDiaria();
    }

    function carregarPlanilhaSalvaDiaria() {
        const dataString = localStorage.getItem(PLANILHA_STORAGE_KEY_DIARIA_V6);
        if (!dataString) return null;
        try {
            return JSON.parse(dataString);
        } catch (e) {
            console.error("Erro ao carregar dados da planilha diária:", e);
            localStorage.removeItem(PLANILHA_STORAGE_KEY_DIARIA_V6);
            return null;
        }
    }

    function abrirPlanilha() {
        planilhaFull.classList.add('active');
        document.querySelector('.navbar-menu a[onclick="abrirPlanilha()"]').classList.add('active-planilha-link');

        const dadosSalvos = carregarPlanilhaSalvaDiaria();
        if (dadosSalvos) {
            jcCapitalInput.value = dadosSalvos.capital > 0 ? dadosSalvos.capital.toString().replace('.', ',') : '';
            jcTaxaInput.value = dadosSalvos.taxaDiaria > 0 ? dadosSalvos.taxaDiaria.toString().replace('.', ',') : '';
            jcDiasPeriodoInput.value = dadosSalvos.diasPeriodo >= 0 ? dadosSalvos.diasPeriodo.toString() : '';
            currentCurrencyDiaria = dadosSalvos.currency || 'BRL';
            jcCurrencySelect.value = currentCurrencyDiaria;
            calcularJurosCompostosDiarios(dadosSalvos.linhas, false);
        } else {
            currentCurrencyDiaria = jcCurrencySelect.value || 'BRL';
            updateCurrencyDisplayDiaria(); // Apenas para o símbolo no TH, se necessário
            jurosTableBody.innerHTML = "<tr><td colspan='6' style='text-align:center; padding: 20px;'>Preencha os campos para iniciar.</td></tr>";
            limparResumoPlanilhaDiaria();
        }
    }

    function fecharPlanilha() {
        planilhaFull.classList.remove('active');
        document.querySelector('.navbar-menu a[onclick="abrirPlanilha()"]').classList.remove('active-planilha-link');
    }

    function limparResumoPlanilhaDiaria() {
        jcMontanteOutput.value = formatCurrencyDiaria(0);
        jcJurosOutput.value = formatCurrencyDiaria(0);
        jcStopWinOutput.value = formatCurrencyDiaria(0);
        jcStopLossOutput.value = formatCurrencyDiaria(0);
        jcDiasMetaOutput.value = "N/A";
    }

    function handleLinhaPlanilhaChangeDiaria() {
        salvarPlanilhaDiaria();
        const dadosSalvos = carregarPlanilhaSalvaDiaria();
        if (dadosSalvos) {
            calcularJurosCompostosDiarios(dadosSalvos.linhas, true);
        }
    }

    function calcularJurosCompostosDiarios(linhasSalvas = null, isInternalUpdate = false) {
        const capitalInicialGlobal = parseFloat(jcCapitalInput.value.replace(',', '.')) || 0;
        const taxaDiariaPerc = parseFloat(jcTaxaInput.value.replace(',', '.')) || 0;
        const taxaDiariaGlobal = taxaDiariaPerc / 100;
        const diasPeriodoTotal = parseInt(jcDiasPeriodoInput.value);

        updateCurrencyDisplayDiaria();

        if (isNaN(diasPeriodoTotal) || capitalInicialGlobal <= 0 || taxaDiariaGlobal < 0 || diasPeriodoTotal < 0) {
             if (capitalInicialGlobal > 0 && diasPeriodoTotal === 0) {
                jurosTableBody.innerHTML = `<tr><td colspan='6' style='text-align:center; padding: 20px;'>0 dias.</td></tr>`;
                atualizarResumoGlobal(capitalInicialGlobal, taxaDiariaGlobal, diasPeriodoTotal, capitalInicialGlobal, 0);
                if (!isInternalUpdate) salvarPlanilhaDiaria();
                return;
            }
            if (!isInternalUpdate) alert("Preencha Capital (>0), Taxa Diária (>=0) e Dias (>=0) corretamente.");
            jurosTableBody.innerHTML = `<tr><td colspan='6' style='text-align:center; padding: 20px;'>Dados inválidos.</td></tr>`;
            limparResumoPlanilhaDiaria();
            return;
        }

        if (!isInternalUpdate) { // Somente recalcula o resumo projetado se for um cálculo principal
            atualizarResumoGlobal(capitalInicialGlobal, taxaDiariaGlobal, diasPeriodoTotal, capitalInicialGlobal, 0);
        }

        if (diasPeriodoTotal === 0 && capitalInicialGlobal > 0) {
            jurosTableBody.innerHTML = `<tr><td colspan='6' style='text-align:center; padding: 20px;'>0 dias.</td></tr>`;
            if (!isInternalUpdate) salvarPlanilhaDiaria();
            return;
        }

        jurosTableBody.innerHTML = "";
        let capitalAtualLinha = capitalInicialGlobal;
        let diasProcessadosNaTabela = 0;

        for (let i = 1; i <= diasPeriodoTotal; i++) {
            diasProcessadosNaTabela = i;
            const metaLucroDia = capitalAtualLinha * taxaDiariaGlobal;

            const tr = document.createElement("tr");
            tr.dataset.dia = i;

            const dadosLinhaSalva = linhasSalvas ? linhasSalvas.find(l => l.dia === i) : null;
            let bancaFinalInformadaPeloUsuario = 0;
            if (dadosLinhaSalva && typeof dadosLinhaSalva.bancaFinalInformada === 'number') {
                bancaFinalInformadaPeloUsuario = dadosLinhaSalva.bancaFinalInformada;
            }
            let acaoSalvaNaLinha = dadosLinhaSalva ? dadosLinhaSalva.acao : null;

            let montanteFinalExibidoNaLinha; // Este será o valor da banca final do dia informado pelo usuário ou o capital inicial se não informado

            if (bancaFinalInformadaPeloUsuario > 0) {
                montanteFinalExibidoNaLinha = bancaFinalInformadaPeloUsuario;
            } else {
                // Se o usuário não informou a banca final (ou é 0 no save),
                // o "Montante Final Dia (Real)" exibido será o capital inicial da linha (dia não operado/resultado neutro).
                montanteFinalExibidoNaLinha = capitalAtualLinha;
            }
            // Casos de quebra
             if (capitalAtualLinha <= 0 && i > 1) {
                montanteFinalExibidoNaLinha = 0;
            } else if (montanteFinalExibidoNaLinha < 0 && capitalAtualLinha > 0) {
                 montanteFinalExibidoNaLinha = 0;
            }

            tr.innerHTML = `
                <td>${i}</td>
                <td>${formatCurrencyDiaria(capitalAtualLinha)}</td>
                <td>${formatCurrencyDiaria(metaLucroDia)}</td>
                <td>
                    <input type="number" class="banca-final-dia-input"
                           data-capital-inicio-dia="${capitalAtualLinha.toFixed(2)}"
                           placeholder="${formatCurrencyDiaria(capitalAtualLinha, currentCurrencyDiaria, false)}"
                           step="any"
                           value="${bancaFinalInformadaPeloUsuario > 0 ? bancaFinalInformadaPeloUsuario.toFixed(2) : ''}"
                           title="Informe o valor total da sua banca ao final deste dia.">
                </td>
                <td>${formatCurrencyDiaria(montanteFinalExibidoNaLinha)}</td>
                <td style="text-align:center;">
                    <button class="meta-btn" title="Marcar Meta Atingida"><i class="fas fa-check-circle"></i> Meta</button>
                    <button class="stop-btn" title="Marcar Stop Loss Atingido"><i class="fas fa-times-circle"></i> Stop</button>
                    <button class="clear-btn" title="Limpar Marcação"><i class="fas fa-eraser"></i> Limpar</button>
                </td>
            `;
            jurosTableBody.appendChild(tr);

            tr.querySelector('.banca-final-dia-input').addEventListener('change', handleLinhaPlanilhaChangeDiaria);
            tr.querySelector('.meta-btn').addEventListener('click', function() { marcarAcaoHandlerDiaria(this.closest('tr'), 'meta'); });
            tr.querySelector('.stop-btn').addEventListener('click', function() { marcarAcaoHandlerDiaria(this.closest('tr'), 'stop'); });
            tr.querySelector('.clear-btn').addEventListener('click', function() { limparMarcacaoHandlerDiaria(this.closest('tr')); });

            if (acaoSalvaNaLinha) {
                aplicarVisualAcaoDiaria(tr, acaoSalvaNaLinha);
            }

            // O capital para o próximo dia é o "Montante Final Dia (Real)" desta linha
            capitalAtualLinha = montanteFinalExibidoNaLinha;
        }

        // Atualiza o resumo dinâmico com base no capital final real da tabela
        if (diasPeriodoTotal > 0) {
            atualizarResumoGlobal(capitalInicialGlobal, taxaDiariaGlobal, diasPeriodoTotal, capitalAtualLinha, diasProcessadosNaTabela);
        }

        if (!isInternalUpdate) {
            salvarPlanilhaDiaria();
        }
    }

    function aplicarVisualAcaoDiaria(row, tipo) {
        row.classList.remove("meta-hit", "loss-hit");
        row.querySelectorAll(".meta-btn, .stop-btn").forEach(btn => {
            btn.disabled = false;
            btn.classList.remove("active-action");
        });
        const metaBtn = row.querySelector(".meta-btn");
        const stopBtn = row.querySelector(".stop-btn");
        if (tipo === 'meta') {
            row.classList.add("meta-hit");
            if(metaBtn) { metaBtn.disabled = true; metaBtn.classList.add("active-action"); }
            if(stopBtn) stopBtn.disabled = true;
        } else if (tipo === 'stop') {
            row.classList.add("loss-hit");
            if(stopBtn) { stopBtn.disabled = true; stopBtn.classList.add("active-action"); }
            if(metaBtn) metaBtn.disabled = true;
        }
    }

    function marcarAcaoHandlerDiaria(row, tipo) {
        aplicarVisualAcaoDiaria(row, tipo);
        handleLinhaPlanilhaChangeDiaria();
    }

    function limparMarcacaoHandlerDiaria(row) {
        row.classList.remove("meta-hit", "loss-hit");
        row.querySelectorAll(".meta-btn, .stop-btn").forEach(btn => {
            btn.disabled = false;
            btn.classList.remove("active-action");
        });
        const bancaInput = row.querySelector('.banca-final-dia-input');
        if (bancaInput) {
             const capitalInicialValor = parseFloat(bancaInput.dataset.capitalInicioDia) || 0;
             bancaInput.value = '';
             bancaInput.placeholder = formatCurrencyDiaria(capitalInicialValor, currentCurrencyDiaria, false);
        }
        handleLinhaPlanilhaChangeDiaria();
    }

    function atualizarResumoGlobal(capitalInicial, taxaDiaria, diasPeriodoTotal, capitalAtualRealDaTabela, diasCorridosNaTabela) {
        if (isNaN(capitalInicial) || isNaN(taxaDiaria) || isNaN(diasPeriodoTotal) || capitalInicial < 0 || diasPeriodoTotal < 0) {
            limparResumoPlanilhaDiaria();
            if (capitalInicial < 0) jcCapitalInput.value = '';
            if (diasPeriodoTotal < 0) jcDiasPeriodoInput.value = '';
            return;
        }
         if (capitalInicial === 0 && diasPeriodoTotal >=0) {
             jcMontanteOutput.value = formatCurrencyDiaria(0);
             jcJurosOutput.value = formatCurrencyDiaria(0);
             jcStopWinOutput.value = formatCurrencyDiaria(0);
             jcStopLossOutput.value = formatCurrencyDiaria(0);
             jcDiasMetaOutput.value = "Capital Zerado";
             return;
        }


        let montanteFinalProjetadoIdeal = capitalInicial;
        if (diasPeriodoTotal > 0) {
            for (let i = 0; i < diasPeriodoTotal; i++) {
                montanteFinalProjetadoIdeal += montanteFinalProjetadoIdeal * taxaDiaria;
            }
        } else {
            montanteFinalProjetadoIdeal = capitalInicial;
        }

        const jurosTotaisProjetados = montanteFinalProjetadoIdeal - capitalInicial;
        const stopWinAlvoProjetado = montanteFinalProjetadoIdeal * 1.10;
        const stopLossGlobal = capitalInicial * 0.90;

        jcMontanteOutput.value = formatCurrencyDiaria(montanteFinalProjetadoIdeal);
        jcJurosOutput.value = formatCurrencyDiaria(jurosTotaisProjetados);
        jcStopWinOutput.value = formatCurrencyDiaria(stopWinAlvoProjetado);
        jcStopLossOutput.value = formatCurrencyDiaria(stopLossGlobal);

        if (capitalAtualRealDaTabela >= stopWinAlvoProjetado) {
            jcDiasMetaOutput.value = "Meta Atingida!";
        } else if (capitalAtualRealDaTabela <= stopLossGlobal && diasCorridosNaTabela > 0) {
            jcDiasMetaOutput.value = "Stop Loss Atingido!";
        } else if (capitalAtualRealDaTabela <= 0 && diasCorridosNaTabela > 0) {
             jcDiasMetaOutput.value = "Banca Zerada!";
        } else if (taxaDiaria <= 0 && stopWinAlvoProjetado > capitalAtualRealDaTabela) { // Adicionado verificação de SW > Capital Atual
            jcDiasMetaOutput.value = "Taxa <= 0";
        } else if (taxaDiaria > 0 && capitalAtualRealDaTabela > 0) { // Só calcula se taxa e capital forem positivos
            let capitalSimulacao = capitalAtualRealDaTabela;
            let diasRestantesParaMeta = 0;
            const maxDiasSimulacaoAdicionais = Math.max(diasPeriodoTotal - diasCorridosNaTabela + 30, 365); // Aumenta um pouco a janela
            let atingiuMetaSimulacao = false;

            if (capitalSimulacao >= stopWinAlvoProjetado) {
                diasRestantesParaMeta = 0;
                atingiuMetaSimulacao = true;
            } else {
                for (let dia = 1; dia <= maxDiasSimulacaoAdicionais; dia++) {
                    capitalSimulacao += capitalSimulacao * taxaDiaria;
                    if (capitalSimulacao >= stopWinAlvoProjetado) {
                        diasRestantesParaMeta = dia;
                        atingiuMetaSimulacao = true;
                        break;
                    }
                }
            }

            if (atingiuMetaSimulacao) {
                jcDiasMetaOutput.value = `${diasRestantesParaMeta} dia(s) restante(s)`;
            } else {
                jcDiasMetaOutput.value = `> ${maxDiasSimulacaoAdicionais} dias`;
            }
        } else if (diasPeriodoTotal === 0 && capitalInicial > 0){ // Trata o caso de 0 dias no período
             jcDiasMetaOutput.value = (taxaDiaria > 0 && stopWinAlvoProjetado > capitalInicial) ? `1 dia(s)` : "N/A";
        } else {
            jcDiasMetaOutput.value = "N/A"; // Fallback
        }
    }


    // Inicialização e Event Listeners Globais
    window.addEventListener('load', () => {
        novoBot();
        atualizarListaBots();

        [jcCapitalInput, jcTaxaInput, jcDiasPeriodoInput].forEach(input => {
            input.addEventListener('change', () => {
                if (planilhaFull.classList.contains('active')) {
                    calcularJurosCompostosDiarios(null, false);
                }
            });
        });

        jcCurrencySelect.addEventListener('change', (e) => {
            currentCurrencyDiaria = e.target.value;
            if (planilhaFull.classList.contains('active')) {
                const dadosAtuais = carregarPlanilhaSalvaDiaria();
                calcularJurosCompostosDiarios(dadosAtuais?.linhas, true);
                salvarPlanilhaDiaria();
            } else {
                updateCurrencyDisplayDiaria();
            }
        });
    });
  </script>
</body>
</html>
